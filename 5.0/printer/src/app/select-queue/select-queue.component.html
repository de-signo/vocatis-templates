<!-- 
  Copyright (C) 2023 DE SIGNO GmbH
  
  This program is dual licensed. If you did not license the program under
  different terms, the following applies:
  
  This program is free software: You can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.
  
  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU Affero General Public License for more details.
  
  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <https://www.gnu.org/licenses/>.
  
 -->

<ng-template #svgPerson let-count>
  <svg class="person" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 39.7 71.2">
    <path class="cls-1" d="M11.6,14.3A6.51,6.51,0,0,0,18.1,8h0a6.38,6.38,0,0,0-6.5-6.3A6.45,6.45,0,0,0,5.1,8a6.51,6.51,0,0,0,6.5,6.3h0" transform="translate(1)"/>
    <path class="cls-1" d="M27,12.8a6.51,6.51,0,0,0,6.5-6.3h0a6.5,6.5,0,0,0-13,0A6.32,6.32,0,0,0,27,12.8h0" transform="translate(1)"/>
    <path class="cls-1" d="M38.7,21.5c0-3.9-2.8-7.2-6.8-8.7h0a7.52,7.52,0,0,1-9.4,0h-.1a11.67,11.67,0,0,0-3.1,1.7,9.15,9.15,0,0,1,5.1,7.9V38.8A4.34,4.34,0,0,1,22,42.1a4.4,4.4,0,0,1-1.6.2V66.1a3.5,3.5,0,0,0,7,0V41.9h.1V66.2a3.5,3.5,0,0,0,7,0V39.9a2.6,2.6,0,0,0,1.5.4,2.64,2.64,0,0,0,2.7-2.4h0V21.5Z" transform="translate(1)"/>
    <path class="cls-1" d="M23.3,23a9.15,9.15,0,0,0-5.1-7.9,8.86,8.86,0,0,0-1.7-.8h0a7.52,7.52,0,0,1-9.4,0H6.9C2.8,15.8,0,19.2,0,23V39.4H0a2.71,2.71,0,0,0,2.7,2.4,2.66,2.66,0,0,0,2.2-1.1v27A3.51,3.51,0,0,0,8.4,71h0a3.46,3.46,0,0,0,3.5-3.4V43.4H12V67.7a3.5,3.5,0,0,0,7,0V41.3l.3.1a2.66,2.66,0,0,0,1.2.3,2.64,2.64,0,0,0,2.7-2.4V35.2Z" transform="translate(1)"/>
    <text class="cls-2" text-anchor="middle" transform="translate(13 34)">{{ count }}</text>
  </svg>
</ng-template>
<ng-template #svgClock>
  <svg class="clock" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M12.3,21.3c-3.9,0-7.1-3.2-7.1-7.1c0-3.9,3.2-7.1,7.1-7.1c3.9,0,7.1,3.2,7.1,7.1
    C19.4,18.2,16.2,21.3,12.3,21.3 M22,12.9c-0.4-3.9-3.6-7.3-7.4-8.2c-0.3-0.1-0.7-0.2-1-0.2c-0.5,0-0.6-0.2-0.6-0.7
    c0-0.3,0-0.6,0-0.9H16c0.2-2,0.1-2.4-1.1-3H9.7C8.6,0.6,8.5,1,8.7,3h1.4h1.5c0,0.5,0,0.9,0,1.3c0,0.1-0.3,0.2-0.4,0.3
    C7.3,5,4,7.9,3,11.6c-1.5,5.6,2.1,11.3,7.8,12.2c0.2,0,0.5,0.1,0.7,0.1h1.6c1.3-0.2,2.5-0.5,3.6-1.1C20.4,21.1,22.4,17.1,22,12.9" />
    <path d="M15.6,8.8C15,9.5,15,9.6,14.4,10.3c-0.9,1.2-1.8,2.4-2.7,3.5c-0.2,0.3-0.4,0.6-0.1,1c0.4,0.4,0.9,0.4,1.2-0.1
    c0.5-0.9,1-1.8,1.6-2.7c0.6-1.1,1.1-1.9,1.7-3c0,0-0.1,0.2,0,0"/>
  </svg>
</ng-template>

<!-- single button -->
<ng-template [ngIf]="buttons.length == 1">
  <ng-template [ngIf]="getViewFor(buttons[0])" let-view>
    <div *ngFor="let button of buttons" (click)="view == 'open' ? print(button) : null" rightClick
         [class]="'buttons buttons-1 btn ' + view" [ngClass]="{'open': view == 'open', 'closed': view != 'open', 'next-one': buttons[0].queueLength == 0}">
      <h5>{{ button.title | selectLang }}</h5>
      <ng-template [ngIf]="!showQrCode">
        <span *ngIf="showQrCode">{{ "List_Print" | translate }}</span> 
        <div class="single-button">
        </div>
      </ng-template>
      <ng-template [ngIf]="showQrCode">
        <div class="button-with-qr">
        <span *ngIf="showQrCode">{{ "List_Print" | translate }}</span>
        <span *ngIf="showQrCode">{{ "List_Scan" | translate }}</span>
          <div class="single-button"></div>
          <qrcode *ngIf="showQrCode" [qrdata]="getAppTicketLink(buttons[0])" [margin]="0" (click)="qrClick(buttons[0])" rightClick></qrcode>
        </div>
      </ng-template>

      <ng-container [ngSwitch]="view">
        <div *ngSwitchCase="'open'" class="queue-status">
          <ng-template [ngIf]="showWaitTime" [ngIfThen]="svgClock"></ng-template>
          <span *ngIf="showWaitTime">{{ "List_StatusWaitTime" | translate: { minutes: button.estimateWaitTime / 60 | number: "1.0-0" } }}</span>
          <ng-container [ngTemplateOutlet]="svgPerson" [ngTemplateOutletContext]="{$implicit: button.queueLength}"></ng-container>
          <span *ngIf="button.queueLength > 3">{{ "List_StatusMT3FormatRaw" | translate: { length: button.queueLength } }}</span>
          <span *ngIf="button.queueLength <= 3">{{ "List_StatusLT3FormatRaw" | translate: { length: button.queueLength } }}</span>
        </div>
        <!-- queue closed (manually) -->
        <h6 *ngSwitchCase="'closed-manually'" class="btn closed closed-manually">
          {{ "List_Closed" | translate }}
        </h6>
        <!-- queue closed (opening hours) -->
        <h6 *ngSwitchCase="'closed-hours'" class="btn closed closed-hours">
          {{ "List_ClosedHours" | translate }}
        </h6>
        <!-- queue full -->
        <h6 *ngSwitchCase="'closed-limit'" class="btn closed closed-limit">
          {{ "List_ClosedFull" | translate }}
        </h6>
      </ng-container>
    </div>
  </ng-template>
</ng-template>

<!-- multiple buttons -->
<div *ngIf="buttons.length > 1" [ngClass]="['buttons', 'buttons-' + buttons.length, showQrCode ? 'with-qr-code' : '']">
  <span *ngIf="showQrCode">{{ "List_Print" | translate }}</span>
  <span *ngIf="showQrCode">{{ "List_Scan" | translate }}</span>
   
  <ng-container *ngFor="let button of buttons" [ngSwitch]="getViewFor(button)">
    <div *ngSwitchCase="'open'" (click)="print(button)" class="btn open" [ngClass]="{'next-one': button.queueLength == 0}" rightClick>
      <h5>{{ button.title | selectLang }}</h5>

      <div #statusPanel class="queue-status" [ngClass]="{'queue-status-columns': showStatusInColumns}">
        <ng-container *ngIf="!showStatusInColumns" [ngTemplateOutlet]="svgPerson" [ngTemplateOutletContext]="{$implicit: button.queueLength}"></ng-container>
        <span *ngIf="button.queueLength > 3">{{ "List_StatusMT3FormatRaw" | translate: { length: button.queueLength } }}</span>
        <span *ngIf="button.queueLength <= 3">{{ "List_StatusLT3FormatRaw" | translate: { length: button.queueLength } }}</span>
        <ng-container *ngIf="showStatusInColumns" [ngTemplateOutlet]="svgPerson" [ngTemplateOutletContext]="{$implicit: button.queueLength}"></ng-container>
        <ng-template [ngIf]="!showStatusInColumns && showWaitTime" [ngIfThen]="svgClock"></ng-template>
        <span *ngIf="showWaitTime">{{ "List_StatusWaitTime" | translate: { minutes: button.estimateWaitTime / 60 | number: "1.0-0" } }}</span>
        <ng-template [ngIf]="showStatusInColumns && showWaitTime" [ngIfThen]="svgClock"></ng-template>
      </div>
    </div>

    <!-- queue closed (manually) -->
    <div *ngSwitchCase="'closed-manually'" class="btn closed closed-manually">
      <h5>{{ button.title | selectLang }}</h5>
      <div>{{ "List_Closed" | translate }}</div>
    </div>
    <!-- queue closed (opening hours) -->
    <div *ngSwitchCase="'closed-hours'" class="btn closed closed-hours">
      <h5>{{ button.title | selectLang }}</h5>
      <div>{{ "List_ClosedHours" | translate }}</div>
    </div>
    <!-- queue full -->
    <div *ngSwitchCase="'closed-limit'" class="btn closed closed-limit">
      <h5>{{ button.title | selectLang }}</h5>
      <div>{{ "List_ClosedFull" | translate }}</div>
    </div>

    <qrcode *ngIf="showQrCode && getViewFor(button) == 'open'" [qrdata]="getAppTicketLink(button)" [margin]="0" (click)="qrClick(button)" rightClick></qrcode>
    <div *ngIf="showQrCode && getViewFor(button) != 'open'">
      <!-- required for grid auto flow -->
    </div>
  </ng-container>
</div>