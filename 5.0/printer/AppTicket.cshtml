@using iSign
@using Stolltec.Vocatis
@using System.Web.Optimization
@using Stolltec.Vocatis.Model
@using Stolltec.Forms.Model
@{
  var partial = Request["X-Requested-With"] == "XMLHttpRequest" || (Request.Headers != null && Request.Headers["X-Requested-With"] == "XMLHttpRequest");

  var tracking_id = Request["t"];
  var lang = Request["lang"] ?? Request["l"];
  var opt = Request["o"];

  dynamic queueid = CommonGuidId.FromString(Request["q"]);
  dynamic catids = GuidIdsFieldInstance.ParseValue("",Request["c"]).Value;
  var ticket = Vocatis.CreateTicket(queueid, catids);
  Response.Redirect(Href("app", new {i=ticket.Id, t=tracking_id, o=opt, l=lang}));
}
