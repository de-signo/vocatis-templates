@*
  Printer navigation level 1
  Get a ticket (no appointment)
*@
<!DOCTYPE html>
@using System.Web.Optimization
@using Stolltec.Forms.Model
@{
  // Parse model
  var Model = new FormsModel(this);

  // setup layout
  PageData["model"] = Model;
  PageData["show_home"] = true;
  PageData["show_back"] = false;
  Layout = "PrinterLayout.cshtml";
}
<div class="site-content">
 <div class="main">
    @* Display list when idle *@
    <div id="queuelist" data-content-src="@Model.Navigate("P1_GetTicket_List.cshtml")">
      <h3>WORÜBER MÖCHTEN SIE HEUTE MIT UNS SPRECHEN?</h3>
      <ul class="flex-container">
        @for (int i = 1; i <= 8; i++) {
          if (!String.IsNullOrEmpty((string)Model.Style["text" + i].Value)) {
            var queueid = Model.Style["queueid" + i].Value;
            <li>
              <a class="btn" href='@Model.Navigate("PrinterTicket.cshtml", new { queueid=queueid, cat=Model.Style["catid" + i].Value })" data-label="@((string)Model.Style["text" + i].Value)'>
                @((string)Model.Style["text" + i].Value)
              </a>
            </li>
          }
        }
      </ul>
    </div>

    @* wait popup is shown, while generating a new number *@
    <section id="waitPopup" style="display: none;">
      <h1>SO GEHT‘S WEITER.</h1>
      <h2>Ziehen Sie ihr Ticket und machen Sie es sich auf dem Sofa bequem.<br>Wir sind ruckzuck für Sie da.</h2>
      <div>
      <img src="images/wait.gif" id="wait" alt="wait" />
      <p>Ihr Ticket wird gedruckt.</p>
    </section>
  </div>
</div>

<script type="text/javascript">
  @*
    This script calls the number generation service
    and prints the number on the default printer.
    It shows the wait popup while waiting and printing.
    It shows the take popup when the printout is ready.
    It reports the printer status to the service.
   *@
  function hookupButtons() {
    $("a.btn").unbind()
    .click(function() {
      $("[data-name]").text($(this).data("label"));
    }).printTicket({
      legacy: false,
      printErrorTimeout: 60000,
      stripBody: false,
      beginPrint: function() {
        $("#waitPopup").show();
      },
      endPrint: function() {
        window.setTimeout(function() { 
          window.location = "@Html.Raw(Model.NavigateHome())";
        }, 3000);
      },
      failPrint: function() {
        $("#waitPopup").hide();
      }
    });
  }

  $(document).ready(function() {
    @* report status of printer *@
    reportPrinterStatus({
      url: "@Href(Stolltec.Forms.PrinterStatus.Path)",
      interval: 60000
	  });
    hookupButtons();
  });
</script>
